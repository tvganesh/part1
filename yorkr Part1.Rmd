---
title: "Introducing cricket package yorkr: Part 1- Beaten by sheer pace!"
author: "Tinniam V Ganesh"
date: "March 22, 2016"
output: html_document
---

*"We need to regard statistical intuition with proper suspicion and replace impression formation by computation wherever possible"*

*"We are pattern seekers, believers in a coherent world"*

*"The hot hand is entirely in the eyes of the beholders, who are consistently"*
*"too quick to perceive order and causality in randomeness. The hot hand is a"*
*"massive and widespread cognitive illusion"*

                       "Thinking, Fast and Slow - Daniel Kahneman"

*Yorker (noun) :A yorker is a bowling delivery in cricket, that pitches at or around the batsman;s toes. Also known as 'toe crusher'*

##**Introduction**
My package 'yorkr' is now available on CRAN. This package is based on data from [Cricsheet](http://cricsheet.org/). Cricsheet has the data of ODIs, Test, Twenty20 and IPL matches as yaml files. The yourkr package provides functions to convert the yaml files to more easily R consumable dataframe. In fact all ODI matches have already been converted and are available for use at [yorkrData](https://github.com/tvganesh/yorkrData). More details below.

### First things first
1. yorkr currently has a total 63 functions as of now. I have intentionally avoided abbreviating function names by dropping vowels, as is usually done because the resulting abbreviated names created would be very difficult to remember and use. So instead of naming *tmBmenPrtshpOppnAllMtches()*, I have used the longer form *teamBatsmenPartnershipOppnAllmatches()*. The longer form will be more intuitive. Moreover RStudio prompts the the different functions which have the same prefix.

2. There are 4 classes of function

a. Team performances in a match
b. Team performances in all matches against a single oppostion (e.g. all matches of India vs Australia or England vs Pakistan)
c. Team perfoamnce all matches against all Opposition
d.Individual performance of batsmen or bowlers



In this post I will  be looking into the 1st class of functions, namely
the performances of opposing teams in a single match
The list of functions are

a. teamBattingScorecardMatch()
b. teamBatsmenPartnershipMatch()
c. teamBatsmenVsBowlersMatch()
d. teamBowlingScorecardMatch()
e. teamBowlingWicketKindMatch()
f. teamBowlingWicketRunsMatch()
g. teamBowlingWicketRunsMatch()
h. teamBowlingWicketMatch()
i. teamBowlersVsBatsmenMatch()
j. matchWormGraph()

```{r}
install.packages("yorkr_0.0.2.tar.gz",repos = NULL, type="source")
library(yorkr)
rm(list=ls())
```


This function will convert a yaml file in the [format as specified in Cricsheet](http://cricsheet.org/format/) to dataframe. This will be saved as
as RData file in the target directtoy. The name of the file wil be
<team1>-<team2>-<date>.RData. This is seen below.

```{r}
convertYaml2RDataframe("225171.yaml","./source","./data")
setwd("./data")
dir()
setwd("..")
```

This function will convert all yaml files from source directory to a dataframe and save it in the target directory with the names as mentioned above. Alteady saved and available at ithub
```{r}
convertAllYaml2RDataframes("./source","./data")
```

Incidentally I have already conbveryted all yaml files in the ODI directory of Cricsheet to dataframes and savced then as RData. Out of 1167 files 34 yaml files had format problems. The rest pof the yaml files ave already been converted to RData and are available for use. All the converted RData files can be accessed from my Github link [yorkrData](https://github.com/tvganesh/yorkrData)

You can download the the zip of the files and use it directly in the function as follows

*Note 1: The package in its current form is based on 50 over ODI macthes. The package will be enhanced to handle Twenty20 matches later*

*Note 2: The link to the converted data framesh have been provided above. The dataframes are around 600 rows x 25 columns. In this post I have created 10 functions that analyze team performances in a match. However you are free to slice and dice the dataframe in any way you like. If you do come up with interesting analyses please do attribute the source of the data to Cricsheet, and my package yorkr and my blog. Also do please do send me a note. It will be much appreciated.* 

In this post I will using the functions from Class 1. For this post  I will be using the match from 5 random matches between 10 different teams. For this I will directly use the converted RData rather than getting the data through the getMatchDetails()

With the RData we can load the data in 2 ways 
1) With getMatchDetails() using the 2 teams and the date on which the 
match occured
```{r}
a <- getMatchDetails("Australia","India","2012-02-12",dir="./data")
```

or
2) Directly load RData into your code. The match details will be loaded
into a data frame called 'overs' which you can assign to a suitable name
as below
```{r}
load("./data/Australia-India-2012-02-12.RData")
aus_ind <- overs
load("./data/England-New Zealand-2007-01-30.RData")
eng_nz <- overs
load("./data/Pakistan-South Africa-2013-11-08.RData")
pak_sa <- overs
load("./data/Sri Lanka-West Indies-2011-02-06.RData")
sl_wi<- overs
load("./data/Bangladesh-Zimbabwe-2009-10-27.RData")
ban_zim <- overs

```


#Matches from 2006
# Only ODIs
# Plot or display data frame. Plot by defau;lt
```{r, echo=FALSE}
a <- getMatchDetails("Australia","India","2012-02-12",dir="./data")
```
```{r}
teamBattingScorecardMatch(aus_ind,'India')
teamBattingScorecardMatch(aus_ind,'Australia')
teamBattingScorecardMatch(pak_sa,'South Africa')
teamBattingScorecardMatch(sl_wi,'Sri Lanka')
```


**Note**: Many of the plots include an additional parameters plot which is either TRUE or FALSE. When plot=TRUE the plot will be displayted. When Plot=FALSE the data frame will be returned to the user
The user can use this to create an interactive chary using one of th epackages like rcharts, ggvis,googleVis ot plotly

```{r}
teamBatsmenPartnershipMatch(pak_sa,"Pakistan")
teamBatsmenPartnershipMatch(eng_nz,"New Zealand",plot=TRUE)
m <-teamBatsmenPartnershipMatch(ban_zim,"Bangladesh",plot=FALSE)
m
teamBatsmenPartnershipMatch(aus_ind,"India",plot=TRUE)
```

```{r}
teamBatsmenVsBowlersMatch(pak_sa,'Pakistan',plot=TRUE)
teamBatsmenVsBowlersMatch(aus_ind,'Australia',plot=TRUE)

teamBatsmenVsBowlersMatch(ban_zim,'Zimbabwe',plot=TRUE)
m <- teamBatsmenVsBowlersMatch(sl_wi,'West Indies',plot=FALSE)
m
```


```{r}
teamBowlingScorecardMatch(eng_nz,'England')
teamBowlingScorecardMatch(eng_nz,'New Zealand')
teamBowlingScorecardMatch(aus_ind,'Australia')
```

```{r}
teamBowlingWicketKindMatch(aus_ind,"India")
teamBowlingWicketKindMatch(aus_ind,"Australia")
teamBowlingWicketKindMatch(pak_sa,"South Africa")
m <-teamBowlingWicketKindMatch(sl_wi,"Sri Lanka",plot=FALSE)
m
```

```{r}
teamBowlingWicketRunsMatch(pak_sa,"Pakistan")
teamBowlingWicketRunsMatch(aus_ind,"Australia")
m <-teamBowlingWicketRunsMatch(sl_wi,"West Indies",plot=FALSE)
m
```

```{r}
m <-teamBowlingWicketMatch(eng_nz,'England',plot=FALSE)
m

teamBowlingWicketMatch(sl_wi,"Sri Lanka")
teamBowlingWicketMatch(eng_nz,"New Zealan")
```


```{r}
teamBowlersVsBatsmenMatch(ban_zim,"Bangladesh")
teamBowlersVsBatsmenMatch(aus_ind,"India")
teamBowlersVsBatsmenMatch(eng_nz,"England")
m <- teamBowlersVsBatsmenMatch(pak_sa,"Pakistan",plot=FALSE)
m
```

```{r}
matchWormGraph(aus_ind,'Australia',"India")
matchWormGraph(sl_wi,'Sri Lanka',"West Indies")

```

`
